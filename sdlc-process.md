# 開発プロセスと承認ゲート (SDLC & Approval Gates)

タスクの規模に応じて、以下の2つのプロセスパターンを使い分けてください。

---

## ブランチ運用ルール

### クラウド環境（claude.ai/code）での作業

クラウド環境で作業を開始する際は、必ず **develop ブランチから作業ブランチを作成** してください。

```bash
# 1. developブランチに切り替え
git checkout develop

# 2. 最新を取得
git pull origin develop

# 3. 作業ブランチを作成
git checkout -b feature/your-feature-name
```

### ブランチ命名規則

| 種別 | プレフィックス | 例 |
|------|----------------|-----|
| 新機能 | `feature/` | `feature/user-auth` |
| バグ修正 | `fix/` | `fix/login-error` |
| リファクタリング | `refactor/` | `refactor/api-client` |
| ドキュメント | `docs/` | `docs/api-spec` |
| 設定変更 | `chore/` | `chore/update-deps` |

### PR作成時のベースブランチ

- **ベースブランチ**: `develop`（必須）
- mainへの直接マージは禁止

## プロセス判定基準

| 判定項目 | 大規模改修 | 小規模改修/バグ改修 |
| :--- | :--- | :--- |
| 新規画面の追加 | あり | なし |
| DBスキーマ変更 | あり | なし or 軽微 |
| 新規APIエンドポイント | 複数 | 0〜1個 |
| 影響範囲 | 複数機能に跨る | 単一機能内で完結 |
| 想定作業量 | 1日以上 | 数時間以内 |

**判断に迷う場合**: ユーザーに確認するか、安全側を取って「大規模改修」プロセスを選択してください。

---

## パターンA: 大規模改修（フルプロセス）

新機能開発や大規模なリファクタリング時に適用します。各フェーズの完了時には必ず停止し、ユーザーの承認を得てください。

| フェーズ | 担当スキル | アウトプット先 | 次に進むための停止条件 |
| :--- | :--- | :--- | :--- |
| **1. 要件定義** | `/product-manager` | `docs/requirements/` | PRD保存後、ユーザーの承認と「設計開始」の指示を待つ。 |
| **2. UI設計** | `/ui-designer` | `docs/design/` | 仕様書保存後、ユーザーの確認を待つ。 |
| **3. 技術設計** | `/architect` | `docs/architecture/` | 仕様書保存後、ユーザーの「実装開始」の指示を待つ。 |
| **4. 実装計画** | `/frontend-dev`, `/backend-dev`, `/infra-dev` | `docs/*/implementation/` | **コード編集前**に詳細な「実装プラン」を提示し、承認を待つ。 |
| **5. 実装実行** | `/frontend-dev`, `/backend-dev`, `/infra-dev` | `apps/`, `infra/`,`docs/database` | 実装とテスト完了後、QAフェーズへの移行指示を待つ。 |
| **6. 品質保証** | `/qa-lead` | `docs/qa/` | QAレポート保存後、LGTM判定をユーザーと最終確認する。 |

---

## パターンB: 小規模改修/バグ改修（簡易プロセス）

バグ修正、軽微な機能改善、UIの微調整などに適用します。

| フェーズ | 担当スキル | 内容 | 備考 |
| :--- | :--- | :--- | :--- |
| **1. 調査・原因特定** | `/bug-investigator` | 問題の再現と原因分析 | バグの場合のみ |
| **2. 実装計画** | `/frontend-dev`, `/backend-dev` | 修正方針を簡潔に提示 | 口頭説明レベルでOK（ドキュメント不要） |
| **3. 実装・テスト** | `/frontend-dev`, `/backend-dev` | コード修正とUT追加 | 既存UTが通ることを確認 |
| **4. セルフレビュー** | 実装者自身 | ガイドライン遵守チェック | 下記チェックリスト参照 |

### 小規模改修セルフレビューチェックリスト
- [ ] 既存のUTが全てパスするか
- [ ] 新規コードに対するUTを追加したか

**注意**: 小規模改修でもDBスキーマ変更が発生する場合は、`/architect` による技術設計を挟んでください。

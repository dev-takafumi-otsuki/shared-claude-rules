# フィードバックループと手戻り (Feedback Loop & Rework)

QAフェーズで「Not LGTM」となった場合、またはユーザーから修正指示があった場合は以下の手順に従ってください。

1. **原因フェーズの特定**: 指摘事項がどの工程（要件/UI設計/技術設計/実装）に起因するかを分析してください。
2. **フェーズ再入場の宣言**: 「QA結果に基づき、フェーズ [X] に戻って修正を行います」と宣言し、対応するスキルをロードしてください。
3. **ドキュメントの連鎖更新**:
   - 修正したフェーズのドキュメント（例：`docs/architecture/`）を更新する。
   - その変更が後続フェーズ（実装など）にどう影響するかを整理し、再度「実装プラン」を提示すること。

---

## 自己改善ループ (Self-Improvement Loop)

> "Claudeが間違えたら、二度と同じ間違いをしないように CLAUDE.md を自分で更新させる" — Boris Cherny

### エラー発生時の自動更新義務

検証（`/verify`）でエラーが出た場合、またはユーザーから修正を指摘された場合、以下を **即座に** 実行すること：

1. **原因の特定**: 何が間違っていたかを具体的に分析
2. **再発防止策の策定**: 同じミスを防ぐためのルールを言語化
3. **ドキュメント更新タスクの自己生成**: 以下の優先順位で更新対象を決定
   - `CLAUDE.md` の「共通技術憲法」に追記（プロジェクト全体に影響する場合）
   - `.claude/skills/*.md` に追記（特定スキルに限定される場合）
   - `.claude/learnings/` に記録（参考情報として残す場合）

### 更新時のフォーマット

```markdown
### [カテゴリ] 追加ルール: [YYYY-MM-DD]
- **背景**: [何が起きたか]
- **ルール**: [今後どうすべきか]
```

### 自動更新のトリガー

| トリガー | アクション |
|----------|------------|
| `/verify` でエラー | 原因分析 → ルール追記 |
| ユーザーからの指摘 | 原因分析 → ルール追記 |
| 同じミスの2回目発生 | **警告レベル上昇** → CLAUDE.md に必須ルールとして追記 |
